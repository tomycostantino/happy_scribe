<div class="w-full max-w-4xl mx-auto py-8">
  <%= page_header("Import from HappyScribe") do %>
    <%= secondary_button(meetings_path) do %>
      <%= left_arrow_icon %>
      Back to Meetings
    <% end %>
  <% end %>

  <% if @error %>
    <div class="rounded-md bg-red-50 p-4 mb-6">
      <div class="flex">
        <%= error_circle_filled_icon(css_class: "h-5 w-5 text-red-400") %>
        <p class="ml-3 text-sm text-red-700"><%= @error %></p>
      </div>
    </div>
  <% end %>

  <% if @transcriptions.any? %>
    <%= card(class: "divide-y divide-gray-100") do %>
      <% @transcriptions.each do |transcription| %>
        <div class="flex items-center justify-between px-5 py-4">
          <div class="min-w-0 flex-1">
            <p class="text-sm font-semibold text-gray-900 truncate"><%= transcription["name"] %></p>
            <div class="flex items-center gap-3 mt-0.5">
              <p class="text-xs text-gray-500">
                <%= formatted_datetime(Time.parse(transcription["createdAt"])) %>
              </p>
              <% if transcription["audioLengthInSeconds"] %>
                <p class="text-xs text-gray-500">
                  <%= (transcription["audioLengthInSeconds"] / 60.0).ceil %> min
                </p>
              <% end %>
              <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium
                <%= transcription["state"] == "automatic_done" ? "bg-green-50 text-green-700" : "bg-yellow-50 text-yellow-700" %>">
                <%= transcription["state"].humanize %>
              </span>
            </div>
          </div>

          <div class="ml-4 shrink-0">
            <% if transcription["already_imported"] %>
              <span class="inline-flex items-center gap-1 text-sm text-gray-400">
                <%= checkmark_icon %>
                Imported
              </span>
            <% elsif transcription["state"] == "automatic_done" %>
              <%= button_to "Import",
                    happy_scribe_imports_path(happyscribe_id: transcription["id"]),
                    method: :post,
                    class: primary_button_class(size: :sm) %>
            <% else %>
              <span class="text-xs text-gray-400">Not ready</span>
            <% end %>
          </div>
        </div>
      <% end %>
    <% end %>

    <% if @next_page_url %>
      <div class="mt-4 text-center">
        <% next_page = URI.parse(@next_page_url).query&.then { |q| Rack::Utils.parse_query(q)["page"] } %>
        <%= link_to "Load more",
              happy_scribe_imports_path(page: next_page),
              class: "text-sm font-medium text-indigo-600 hover:text-indigo-500" %>
      </div>
    <% end %>
  <% elsif @error.blank? %>
    <%= card do %>
      <%= empty_state(icon: :document, title: "No transcriptions found", subtitle: "There are no transcriptions in your HappyScribe account.") %>
    <% end %>
  <% end %>
</div>
