<%= tag.div id: "meeting_#{meeting.id}_content", class: "w-full flex flex-col grow min-h-0" do %>
  <% if meeting.transcript&.completed? %>
    <div class="flex flex-1 min-h-0">
      <%# Left sidebar: participants + action items %>
      <div class="w-80 shrink-0 border-r border-gray-200 flex flex-col min-h-0">
        <div class="overflow-y-auto flex-1 p-4">
          <div class="mb-4">
            <%= back_link("Back to Meetings", meetings_path) %>
          </div>
          <div class="mb-6">
            <%= render "meetings/header", meeting: meeting %>
          </div>
          <div class="mb-6">
            <%= render "meetings/participants", meeting: meeting %>
          </div>
          <%= render "meetings/action_items", meeting: meeting %>
        </div>
      </div>

      <%# Main content: transcript + chat side by side %>
      <div class="flex-1 grid grid-cols-2 gap-6 min-h-0 p-6">
        <%# Transcript column %>
        <%= card class: "flex flex-col min-h-0" do %>
          <div class="px-6 py-4 border-b border-gray-100">
            <%= section_header("Transcript") %>
          </div>
          <div class="px-6 py-5 overflow-y-auto flex-1">
            <div class="space-y-4">
              <% meeting.transcript.transcript_segments.ordered.each do |segment| %>
                <div>
                  <div class="flex items-baseline gap-2">
                    <span class="text-sm font-semibold text-indigo-600"><%= segment.speaker %></span>
                    <span class="text-xs text-gray-400"><%= Time.at(segment.start_time || 0).utc.strftime("%H:%M:%S") %></span>
                  </div>
                  <p class="text-sm text-gray-700 mt-1 leading-relaxed"><%= segment.content %></p>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>

        <%# Chat column %>
        <%= card class: "flex flex-col min-h-0" do %>
          <div class="p-4 flex-1 flex flex-col min-h-0">
            <%= turbo_frame_tag "meeting_chats", src: meeting_chats_path(meeting), loading: :lazy, class: "flex-1 flex flex-col min-h-0" do %>
              <div class="text-center py-4">
                <p class="text-sm text-gray-400">Loading chat...</p>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

  <% else %>
    <div class="mb-6 shrink-0">
      <%= back_link("Back to Meetings", meetings_path) %>
    </div>
    <div class="shrink-0">
      <%= render "meetings/header", meeting: meeting %>
    </div>

    <%# Single-column for non-completed states %>
    <div class="max-w-3xl mx-auto mt-6">
      <%= card do %>
        <div class="px-6 py-5">
          <% if meeting.failed? %>
            <div class="rounded-md bg-red-50 p-4 text-center">
              <%= error_circle_icon(css_class: "mx-auto h-8 w-8 text-red-400 mb-2") %>
              <p class="text-sm font-medium text-red-800">Transcription failed</p>
              <p class="text-sm text-red-600 mt-1">Please try uploading again.</p>
            </div>
          <% else %>
            <div class="rounded-md bg-gray-50 p-6 text-center">
              <%= spinner_icon(css_class: "mx-auto h-8 w-8 text-gray-400 mb-2 animate-pulse") %>
              <p class="text-sm font-medium text-gray-900">Transcription in progress</p>
              <p class="text-sm text-gray-500 mt-1">This page will update automatically.</p>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>
<% end %>
