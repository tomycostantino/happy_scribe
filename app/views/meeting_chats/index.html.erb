<%= turbo_frame_tag "meeting_chats" do %>
  <div class="flex flex-col h-full">
    <div class="mb-4"><%= section_header("Chat with this meeting") %></div>

    <% if @chats.any? %>
      <div class="space-y-2 mb-4 flex-1 overflow-y-auto">
        <% @chats.each do |chat| %>
          <div class="flex items-center justify-between rounded-md bg-gray-50 px-3 py-2">
            <div class="text-sm text-gray-700">
              Chat from <%= short_datetime(chat.created_at) %>
              <span class="text-gray-400">(<%= chat.messages.where(role: "assistant").count %> responses)</span>
            </div>
            <%= link_to "Continue", meeting_chat_path(@meeting, chat),
                  class: "text-sm font-medium text-indigo-600 hover:text-indigo-500",
                  data: { turbo_frame: "meeting_chats" } %>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="flex-1"></div>
    <% end %>

    <%# Quick-action buttons â€” driven by tool class metadata %>
    <div class="flex flex-wrap gap-2 mb-3 mt-auto">
      <% Chat.meeting_tool_buttons.each do |label, prompt| %>
        <%= button_to label, meeting_chats_path(@meeting),
              params: { prompt: prompt },
              class: "rounded-full border border-gray-300 bg-white px-3 py-1.5 text-xs font-medium text-gray-700 shadow-sm hover:bg-gray-50 hover:border-indigo-300 hover:text-indigo-600 transition-colors cursor-pointer" %>
      <% end %>
    </div>

    <%= form_with url: meeting_chats_path(@meeting), method: :post, class: "flex gap-2" do |f| %>
      <%= f.text_field :prompt,
          placeholder: "Ask about this meeting...",
          class: form_input_class(variant: :chat),
          autofocus: true %>
      <%= f.submit "New chat",
          class: "rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 cursor-pointer" %>
    <% end %>
  </div>
<% end %>
