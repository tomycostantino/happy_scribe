<%= turbo_stream_from "chat_#{@chat.id}" %>

<% content_for :title, "Chat" %>

<div class="w-full max-w-4xl mx-auto p-8">
  <%= flash_messages %>

  <div class="mb-6">
    <%= back_link "Back to chats", chats_path %>
  </div>

  <h1 class="text-xl font-bold text-gray-900">Chat</h1>
  <p class="text-sm text-gray-500 mt-1">Using <strong><%= @chat.model.name %></strong></p>

  <div id="chat_<%= @chat.id %>_messages" class="space-y-3 mt-6" data-controller="autoscroll">
    <% @chat.messages.visible.each do |message| %>
      <%= render message %>
    <% end %>

    <% if @chat.messages.visible.last&.role == "user" %>
      <%= render "messages/thinking", chat: @chat %>
    <% end %>
  </div>

  <div class="mt-6">
    <%= render "messages/form", chat: @chat, message: @message %>
  </div>
</div>
